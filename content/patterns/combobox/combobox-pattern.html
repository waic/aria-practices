<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>コンボボックスパターン</title>

    <!-- Core JS and CSS shared by all patterns -->
    <link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2016/base.css">
    <link rel="stylesheet" href="../../shared/css/core.css">
    <script src="../../shared/js/highlight.pack.js"></script>
    <script src="../../shared/js/app.js"></script>
    <script data-skipto="colorTheme:aria; displayOption:popup; containerElement:div" src="../../shared/js/skipto.js"></script>
  </head>
  <body>
    <main>
      <h1>コンボボックスパターン</h1>
      <!-- 翻訳元リビジョン: https://github.com/w3c/aria-practices/tree/2d60c413ec23875a30162364a7e715b26875d9db -->

      <section id="about">
        <h2>このパターンについて</h2>
        <p>
          コンボボックスは、関連付けられたポップアップを持つ入力ウィジェットです。
          ポップアップにより、利用者はコレクションから入力値を選択できます。
          ポップアップは、<a href="../listbox/listbox-pattern.html">リストボックス</a>、<a href="../grid/grid-pattern.html">グリッド</a>、<a href="../treeview/treeview-pattern.html">ツリー</a>、又は<a href="../dialog-modal/dialog-modal-pattern.html">ダイアログ</a>である可能性があります。
        </p>
        <p>
          いくつかの実装では、ポップアップは許可された値を表示し、他の実装では、ポップアップは提案された値を表示します。
          多くの実装には、三つ目の任意の要素、コンボボックスに隣接するグラフィカルな「開く」ボタンも含まれており、ポップアップが使用可能であることを示します。
          「開く」ボタンを作動すると、提案が利用可能な場合にポップアップが表示されます。
        </p>
        <p>
          コンボボックスパターンは、いくつかの任意の動作をサポートします。
          インタラクションを最も形作るものはテキスト入力です。
          一部のコンボボックスでは、利用者がコンボボックス内でテキストを入力及び編集できますが、他のコンボボックスではできません。
          テキスト入力をサポートしないコンボボックスは、選択限定と呼ばれ、利用者がその値を設定できる唯一の方法はポップアップで値を選択することです。
          例えば、一部のブラウザでは、 <code>size="1"</code> を持つ HTML の <code>select</code> 要素は、支援技術に対してコンボボックスとして提示されます。
          あるいは、コンボボックスがテキスト入力をサポートする場合、編集可能と呼ばれます。
          編集可能なコンボボックスは、利用者が任意の値を入力することを許可するか、又は許可された値の離散的なセットに値を制限することができ、その場合、入力の入力がポップアップに表示される提案をフィルタリングするために役立ちます。
        </p>
        <p>
          ポップアップはデフォルトで非表示、つまり折り畳まれた状態です。
          ポップアップの展開、つまりポップアップの表示をトリガする条件は、実装ごとに異なります。
          展開をトリガする可能性のあるいくつかの条件には、以下が含まれます。
        </p>
        <ul>
          <li>
            <kbd>下矢印</kbd>キーが押された場合又は「開く」ボタンが作動した場合に表示されます。
            オプションとして、コンボボックスが編集可能で許可された値と一致しない文字列が含まれている場合、展開は発生しません。
          </li>
          <li>コンボボックスがフォーカスを受けると、コンボボックスが編集可能で空の場合でも表示されます。</li>
          <li>コンボボックスが編集可能な場合、ポップアップは、特定の数の文字がコンボボックスに入力され、それらの文字が提案された値の一部と一致する場合にのみ表示されます。</li>
        </ul>
        <p>コンボボックスウィジェットは、次の 2 つのシナリオのいずれかで利用者入力を取得するのに役立ちます。</p>
        <ol>
          <li>
            値は、事前に定義された一連の許可された値のいずれかである必要があります。例えば、場所フィールドは有効な場所名を含んでいる必要があります。
            リストボックスとメニューボタンパターンもこのシナリオで有用であることに注意してください。コンボボックスと代替パターン間の違いについては以下で説明します。
          </li>
          <li>
            任意の値が許可されますが、利用者に可能な値を提案することは好都合です。
            例えば、検索フィールドは、類似又は以前の検索を提案して、利用者の時間を節約できます。
          </li>
        </ol>
        <p>
          ポップアップによって提示される有効な値の性質とその提示方法は、オートコンプリート動作と呼ばれます。
          コンボボックスには、次の 4 つのオートコンプリート形式のいずれかがあります。</p>
        <ol>
          <li>
            <strong>オートコンプリートなし：</strong>コンボボックスは編集可能であり、ポップアップがトリガされると、それに含まれる提案された値は、コンボボックスに入力された文字に関係なく同じです。
            例えば、ポップアップは最近入力された値のセットを提案し、提案は利用者が入力した内容を変更しません。
          </li>
          <li>
            <strong>手動選択付きリストオートコンプリート：</strong>ポップアップがトリガされると、提案された値が表示されます。
            コンボボックスが編集可能な場合、提案された値は、コンボボックスに入力された文字を補完又はその文字と論理的に対応します。
            利用者が入力した文字列は、利用者がポップアップで値を選択しない限り、コンボボックスの値になります。
          </li>
          <li>
            <strong>自動選択付きリストオートコンプリート：</strong>コンボボックスは編集可能であり、ポップアップがトリガされると、コンボボックスに入力された文字を補完する又は論理的に対応する提案された値が表示され、最初の提案が自動的に強調表示されて選択されます。
            自動的に選択された提案は、利用者が別の提案を選択するか、コンボボックス内の文字列を変更しない限り、コンボボックスがフォーカスを失ったときにコンボボックスの値になります。
          </li>
          <li>
            <strong>インラインオートコンプリート付きリスト：</strong>これは、自動選択付きリストと同じで、追加機能が一つあります。
            利用者が入力したものではない選択された提案の一部分である補完文字列が、コンボボックスの入力カーソルの後にインラインで表示されます。
            インライン補完文字列は視覚的に強調表示され、選択状態になります。</li>
        </ol>
        <p>
          コンボボックスが編集可能で何らか形のリストオートコンプリートを持っている場合、ポップアップは利用者の入力に応じて表示及び非表示になる可能性があります。
          例えば、利用者が 2 文字の文字列を入力して 5 つの提案を表示するようにトリガし、次に一致する提案を持たない文字列を形成する 3 文字目を入力すると、ポップアップが閉じられ、存在する場合、インライン補完文字列が消えます。
        </p>
        <p>
          視覚的にコンパクトで、利用者が別個の選択肢のセットから単一の選択を行うことを可能にする他の 2 つのウィジェットは、<a href="../listbox/listbox-pattern.html">リストボックス</a>と<a href="../menu-button/menu-button-pattern.html">メニューボタン</a>です。
          コンボボックスとリストボックス及びメニューボタンを区別する 1 つの機能は、利用者の選択が編集可能なフィールドの値として表示できることであり、これにより利用者はクリップボードにコピーするために値の一部又は全てを選択できます。
          コンボボックスとメニューボタンは、利用者が以前に選択したものを失うことなく、許可された選択肢のセットを探索できるように実装できます。
          つまり、利用者はコンボボックスポップアップ又はメニュー内の利用可能な選択肢のセットをナビゲートして <kbd>Escape</kbd> を押すことができ、そうすると以前の入力を変更せずにポップアップ又はメニューを閉じます。
          対照的に、単一選択リストボックス内の選択肢間のナビゲーションはすぐにその値を変更し、<kbd>Escape</kbd> は元に戻すメカニズムを提供しません。
          コンボボックスとリストボックスは、<code>aria-required="true"</code> で必須としてマークでき、それらはそれらの値とは異なるアクセシブル名を持ちます。
          したがって、支援技術利用者がデフォルト状態のコンボボックス又はリストボックスにフォーカスすると、ウィジェットの名前と値の両方を認識できます。
          ただし、メニューボタンは必須としてマークすることはできず、アクセシブル名がありますが、値を持たないため、折り畳まれた状態で利用者の選択を伝えるのに適していません。
        </p>
      </section>

      <section id="examples">
        <img alt="" src="../../images/pattern-combobox.svg">
        <h2>例</h2>
        <ul>
          <li><a href="examples/combobox-select-only.html">選択限定コンボボックス</a>: HTML の <code>select</code> 要素と機能的に類似したテキスト入力のない単一選択コンボボックス。</li>
          <li><a href="examples/combobox-autocomplete-both.html">リストとインラインオートコンプリートの両方を備えた編集可能コンボボックス</a>: 「インラインオートコンプリート付きリスト」として知られるオートコンプリート動作を示す編集可能コンボボックス。</li>
          <li><a href="examples/combobox-autocomplete-list.html">リストオートコンプリート付き編集可能コンボボックス</a>: 「手動選択付きリスト」として知られるオートコンプリート動作を示す編集可能コンボボックス。</li>
          <li><a href="examples/combobox-autocomplete-none.html">オートコンプリートなしの編集可能コンボボックス</a>: <code>aria-autocomplete=none</code> に関連付けられた動作を示す編集可能コンボボックス。</li>
          <li><a href="examples/grid-combo.html">グリッドポップアップ付き編集可能コンボボックス</a>: 各提案に関する説明情報を利用者がナビゲートできるように、提案をグリッドで表示する編集可能コンボボックス。</li>
          <li><a href="examples/combobox-datepicker.html">日付選択コンボボックス</a>: カレンダーグリッドと月及び年単位でナビゲートするためのボタンを含むダイアログを開く編集可能な日付入力コンボボックス。</li>
        </ul>
      </section>

      <section id="keyboard_interaction">
        <h2>キーボード操作</h2>
        <ul>
          <li><kbd>Tab</kbd>: コンボボックスはページの <kbd>Tab</kbd> シーケンスの中にあります。</li>
          <li>注記: ポップアップインジケータアイコン又はボタン (存在する場合) 、ポップアップ、及びポップアップの子孫は、ページの <kbd>Tab</kbd> シーケンスから除外されます。</li>
        </ul>
        <h3>コンボボックスのキーボード操作</h3>
        <p>コンボボックスにフォーカスがある場合:</p>
        <ul>
          <li>
            <kbd>下矢印</kbd>: ポップアップが利用可能な場合、ポップアップ内にフォーカスを移動します。
            <ul>
              <li><kbd>下矢印</kbd>が押される前にオートコンプリート動作が提案を自動的に選択した場合、自動的に選択された提案の次の提案にフォーカスが置かれます。</li>
              <li>それ以外の場合、ポップアップ内の最初のフォーカス可能な要素にフォーカスを置きます。</li>
            </ul>
          </li>
          <li><kbd>上矢印</kbd> (任意): ポップアップが利用可能な場合、ポップアップ内の最後のフォーカス可能な要素にフォーカスを置きます。</li>
          <li>
            <kbd>Escape</kbd>: ポップアップが表示されている場合、ポップアップを閉じます。
            オプションとして、<kbd>Escape</kbd> が押される前にポップアップが非表示の場合、コンボボックスをクリアします。
          </li>
          <li>
            <kbd>Enter</kbd>: コンボボックスが編集可能で、ポップアップでオートコンプリートの提案が選択されている場合、提案を受け入れます。これは、コンボボックス内の受け入れられた値の最後に入力カーソルを配置するか、値に対してデフォルトのアクションを実行することによって行われます。
            例えば、メッセージングアプリケーションでは、デフォルトのアクションは、受け入れられた値をメッセージ受信者のリストに追加してから、コンボボックスをクリアして利用者が別の受信者を追加できるようにすることです。
          </li>
          <li>
            表示可能文字:
            <ul>
              <li>
                コンボボックスが編集可能な場合、コンボボックスに文字を入力します。
                一部の実装では特定の文字を無効と見なし、入力できない場合があります。
              </li>
              <li>コンボボックスが編集不可能な場合、オプションで入力された文字で始まる値にフォーカスを移動します。</li>
            </ul>
          </li>
          <li>コンボボックスが編集可能な場合、デバイスプラットフォームに適した標準的な単一行テキスト編集キーをサポートします (下の注記を参照)。</li>
          <li><kbd>Alt + 下矢印</kbd> (オプション): ポップアップが利用可能だが表示されていない場合、フォーカスを移動せずにポップアップを表示します。</li>
          <li>
            <kbd>Alt + 上矢印</kbd> (オプション): ポップアップが表示されている場合:
            <ul>
              <li>ポップアップにフォーカスがある場合、フォーカスをコンボボックスに戻します。</li>
              <li>ポップアップを閉じます。</li>
            </ul>
          </li>
        </ul>
        <div class="note">
          <h4>注記</h4>
          <p>デバイスプラットフォームに適した標準的な単一行テキスト編集キー:</p>
          <ol>
            <li>入力、カーソル移動、選択、テキスト操作のためのキーが含まれます。</li>
            <li>編集機能の標準的なキー割り当ては、デバイスのオペレーティングシステムに基づきます。</li>
            <li>テキスト編集機能を提供するための最も堅牢なアプローチは、ブラウザに依存することです。ブラウザは、type text を持つ HTML 入力及び <code>contenteditable</code> HTML 属性を持つ要素に対してそれらを供給します。</li>
            <li><strong>重要:</strong> JavaScript が、それらを実行するために使用されるキーのキーイベントをキャプチャすることによって、ブラウザ提供のテキスト編集機能を妨げないようにしてください。</li>
          </ol>
        </div>
        <h3>リストボックスポップアップのキーボード操作</h3>
        <p>リストボックスポップアップにフォーカスがある場合:</p>
        <ul>
          <li><kbd>Enter</kbd>: ポップアップを閉じてリストボックス内のフォーカスされた選択肢を受け入れ、受け入れられた値をコンボボックスに配置し、コンボボックスが編集可能な場合は、値の最後に入力カーソルを配置します。</li>
          <li>
            <kbd>Escape</kbd>: ポップアップを閉じて、フォーカスをコンボボックスに戻します。
            任意で、コンボボックスが編集可能な場合、コンボボックスの内容をクリアします。
          </li>
          <li>
            <kbd>下矢印</kbd>: 次の選択肢にフォーカスを移動して選択します。
            フォーカスが最後の選択肢にある場合、フォーカスをコンボボックスに戻すか、何も行いません。
          </li>
          <li>
            <kbd>上矢印</kbd>: 前の選択肢にフォーカスを移動して選択します。
            フォーカスが最初の選択肢にある場合、フォーカスをコンボボックスに戻すか、何も行いません。
          </li>
          <li>
            <kbd>右矢印</kbd>: コンボボックスが編集可能な場合、ポップアップを閉じずにコンボボックスにフォーカスを戻し、入力カーソルを1文字右に移動します。
            入力カーソルが右端の文字にある場合、カーソルは動きません。
          </li>
          <li>
            <kbd>左矢印</kbd>: コンボボックスが編集可能な場合、ポップアップを閉じずにコンボボックスにフォーカスを戻し、入力カーソルを1文字左に移動します。
            入力カーソルが左端の文字にある場合、カーソルは動きません。
          </li>
          <li><kbd>Home</kbd> (任意): 最初の選択肢にフォーカスを移動して選択するか、コンボボックスが編集可能な場合は、フォーカスをコンボボックスに戻してカーソルを最初の文字に配置します。</li>
          <li><kbd>End</kbd> (任意): 最後の選択肢にフォーカスを移動するか、コンボボックスが編集可能な場合は、フォーカスをコンボボックスに戻してカーソルを最後の文字の後に配置します。</li>
          <li>
            任意の表示可能文字:
            <ul>
              <li>コンボボックスが編集可能な場合、ポップアップを閉じずにコンボボックスにフォーカスを戻して文字を入力します。</li>
              <li>それ以外の場合、入力された文字で始まる名前を持つ次のオプションにフォーカスを移動します。</li>
            </ul>
          </li>
          <li><kbd>Backspace</kbd> (任意): コンボボックスが編集可能な場合、フォーカスをコンボボックスに戻してカーソルの前の文字を削除します。</li>
          <li><kbd>Delete</kbd> (任意): コンボボックスが編集可能な場合、フォーカスをコンボボックスに戻し、提案が選択されていた場合は選択状態を削除し、インラインオートコンプリート文字列が存在する場合は削除します。</li>
        </ul>
        <div class="note">
          <h4>注記</h4>
          <ol>
            <li>
              DOM フォーカスはコンボボックスに維持され、支援技術のフォーカスは、<a href="../../practices/keyboard-interface/keyboard-interface-practice.html#kbd_focus_activedescendant">aria-activedescendant を使用した複合要素でのフォーカスの管理</a>で説明されているように、<code>aria-activedescendant</code> を使用してリストボックス内で移動されます。
            </li>
            <li>選択はリストボックス内のフォーカスに従います。リストボックスでは、コンボボックス値に対して一度に一つの提案値のみを選択できます。</li>
          </ol>
        </div>
        <h3>グリッドポップアップのキーボード操作</h3>
        <p>
          グリッドポップアップでは、各提案値は単一のセル又は行全体で表される場合があります。
          グリッドデザインのこの側面が、キーボード操作設計とフォーカスの移動に応じた選択の移動方法にどのように影響するかについては、後述の注記を参照してください。
        </p>
        <ul>
          <li><kbd>Enter</kbd>: ポップアップを閉じ、選択された値をコンボボックスに配置し、コンボボックスが編集可能な場合は、値の最後に入力カーソルを配置することで、現在選択されている提案値を受け入れます。</li>
          <li>
            <kbd>Escape</kbd>: ポップアップを閉じて、フォーカスをコンボボックスに戻します。
            任意で、コンボボックスが編集可能な場合、コンボボックスの内容をクリアします。
          </li>
          <li>
            <kbd>右矢印</kbd>: フォーカスを1セル右に移動します。
            任意で、フォーカスが行の一番右のセルにある場合、フォーカスは次の行の一番左のセルに移動してもよいです。
            グリッドの最後のセルにフォーカスがある場合、何もしないか、フォーカスをコンボボックスに戻します。
          </li>
          <li>
            <kbd>左矢印</kbd>: フォーカスを1セル左に移動します。
            任意で、フォーカスが行の一番左のセルにある場合、フォーカスは前の行の一番右のセルに移動してもよいです。
            グリッドの最初のセルにフォーカスがある場合、何もしないか、フォーカスをコンボボックスに戻します。
          </li>
          <li>
            <kbd>下矢印</kbd>: フォーカスを1セル下に移動します。
            グリッドの最後の行にフォーカスがある場合、何もしないか、フォーカスをコンボボックスに戻します。
          </li>
          <li>
            <kbd>上矢印</kbd>: フォーカスを1セル上に移動します。
            グリッドの一番上の行にフォーカスがある場合、何もしないか、フォーカスをコンボボックスに戻します。
          </li>
          <li>
            <kbd>Page Down</kbd> (任意): フォーカスを作者が決定した行数だけ下に移動します。通常、スクロールして、現在表示されている行セットの一番下の行が最初に表示される行の1つになります。
            グリッドの最後の行にフォーカスがある場合、フォーカスは動きません。
          </li>
          <li>
            <kbd>Page Up</kbd> (任意): フォーカスを作者が決定した行数だけ上に移動します。通常、スクロールして、現在表示されている行セットの一番上の行が最後に表示される行の1つになります。
            グリッドの一番上の行にフォーカスがある場合、フォーカスは動きません。
          </li>
          <li>
            <kbd>Home</kbd> (任意): <strong>どちらか:</strong>
            <ul>
              <li>
                フォーカスのある行の最初のセルにフォーカスを移動します。
                又は、グリッドが 1 行あたり 3 セル未満の場合、又は 1 行あたり複数の提案値がある場合、グリッドの最初のセルにフォーカスが移動してもよいです。
              </li>
              <li>コンボボックスが編集可能な場合は、フォーカスをコンボボックスに戻してカーソルを最初の文字に配置します。</li>
            </ul>
          </li>
          <li>
            <kbd>End</kbd> (任意): <strong>どちらか:</strong>
            <ul>
              <li>
                フォーカスのある行の最後のセルにフォーカスを移動します。
                又は、グリッドが 1 行あたり 3 セル未満の場合、又は 1 行あたり複数の提案値がある場合、グリッドの最後のセルにフォーカスが移動してもよいです。
              </li>
              <li>コンボボックスが編集可能な場合、フォーカスをコンボボックスに戻してカーソルを最後の文字の後に配置します。</li>
            </ul>
          </li>
          <li><kbd>Control + Home</kbd> (任意): 最初の行にフォーカスを移動します。</li>
          <li><kbd>Control + End</kbd> (任意): 最後の行にフォーカスを移動します。</li>
          <li>任意の表示可能文字: コンボボックスが編集可能な場合、ポップアップを閉じずにコンボボックスにフォーカスを戻して文字を入力します。</li>
          <li><kbd>Backspace</kbd> (任意): コンボボックスが編集可能な場合、フォーカスをコンボボックスに戻してカーソルの前の文字を削除します。</li>
          <li><kbd>Delete</kbd> (任意): コンボボックスが編集可能な場合、フォーカスをコンボボックスに戻し、提案が選択されていた場合は選択状態を削除し、インラインオートコンプリート文字列が存在する場合は削除します。</li>
        </ul>
        <div class="note">
          <h4>注記</h4>
          <ol>
            <li>
              DOM フォーカスはコンボボックスに維持され、支援技術のフォーカスは、<a href="../../practices/keyboard-interface/keyboard-interface-practice.html#kbd_focus_activedescendant">複合要素での aria-activedescendant を使用したフォーカスの管理</a>で説明されているように、<code>aria-activedescendant</code> を使用してグリッド内で移動されます。
            </li>
            <li>グリッドでは、コンボボックスの値に対して一度に一つの提案値のみを選択できます。</li>
            <li>
              グリッドポップアップでは、各提案値は単一のセル又は行全体で表される場合があります。
              このデザインの側面は、フォーカスと選択の移動に影響します。
              <ol>
                <li>
                  各セルに異なる提案値が含まれている場合:
                  <ul>
                    <li>フォーカスを含むセルが選択されるように、選択はフォーカスに従います。</li>
                    <li>水平方向の矢印キーナビゲーションは通常、ある行から前後の行へ移動します。(訳註: 原文では "wrap" の語が使われており、行の先頭や末尾にフォーカスがある場合にその前後の行に回り込むように移動することが表現されています。)</li>
                    <li>垂直方向の矢印キーナビゲーションは通常、ある列から前後の列へ移動します。(訳註: 原文では "wrap" の語が使われており、列の先頭や末尾にフォーカスがある場合にその前後の列に回り込むように移動することが表現されています。)</li>
                  </ul>
                </li>
                <li>
                  行内のすべてのセルに同じ提案値に関する情報が含まれている場合:
                  <ul>
                    <li>フォーカスを含む行が選択されるか、同じ行内の任意のセルにフォーカスがあるときに提案値を含むセルが選択されます。</li>
                    <li>水平方向の矢印キーナビゲーションは、ある行から前後の行へ移動してもよいです。(訳註: 原文では "wrap" の語が使われており、行の先頭や末尾にフォーカスがある場合にその前後の行に回り込むように移動することが表現されています。)</li>
                    <li>垂直方向の矢印キーナビゲーションは、ある列から前後の列へ移動<strong>しません</strong>。(訳註: 原文では "wrap" の語が使われており、列の先頭や末尾にフォーカスがある場合にその前後の列に回り込むように移動しないことが表現されています。)</li>
                  </ul>
                </li>
              </ol>
            </li>
          </ol>
        </div>
        <h3>ツリーポップアップのキーボード操作</h3>
        <p>
          ツリーポップアップの一部の実装では、一部又は全ての親ノードが提案カテゴリラベルとして機能するため、選択可能な値ではない場合があります。
          デザインのこの側面が、フォーカスの移動に応じた選択の移動方法にどのように影響するかについては、以下の注記を参照してください。
        </p>
        <p>縦向きツリーポップアップにフォーカスがある場合:</p>
        <ul>
          <li><kbd>Enter</kbd>: ポップアップを閉じ、選択された値をコンボボックスに配置し、コンボボックスが編集可能な場合は、値の最後に入力カーソルを配置することで、現在選択されている提案値を受け入れます。</li>
          <li>
            <kbd>Escape</kbd>: ポップアップを閉じて、フォーカスをコンボボックスに戻します。
            任意で、コンボボックスの内容をクリアします。
          </li>
          <li>
            <kbd>右矢印</kbd>:
            <ul>
              <li>フォーカスが閉じられたノードにある場合、ノードを開きます。フォーカスと選択は移動しません。</li>
              <li>フォーカスが開いたノードにある場合、フォーカスを最初の子ノードに移動し、選択可能な場合は選択します。</li>
              <li>フォーカスが終端ノードにある場合、何も行いません。</li>
            </ul>
          </li>
          <li>
            <kbd>左矢印</kbd>:
            <ul>
              <li>フォーカスが開いたノードにある場合、ノードを閉じます。</li>
              <li>フォーカスが子ノードにあり、またそれが終端ノード又は閉じられたノードのいずれかである場合、フォーカスをその親ノードに移動し、選択可能な場合は選択します。</li>
              <li>フォーカスがルートノードにあり、またそれが終端ノード又は閉じられたノードのいずれかである場合、何も行いません。</li>
            </ul>
          </li>
          <li><kbd>下矢印</kbd>: ノードを開閉せずに、フォーカス可能な次のノードにフォーカスを移動し、選択可能な場合は選択します。</li>
          <li><kbd>上矢印</kbd>: ノードを開閉せずに、フォーカス可能な前のノードにフォーカスを移動し、選択可能な場合は選択します。</li>
          <li><kbd>Home</kbd>: ノードを開閉せずに、ツリー内の最初のフォーカス可能なノードにフォーカスを移動し、選択可能な場合は選択します。</li>
          <li><kbd>End</kbd>: ノードを開閉せずに、ツリー内の最後のフォーカス可能なノードにフォーカスを移動し、選択可能な場合は選択します。</li>
          <li>
            任意の表示可能文字:
            <ul>
              <li>コンボボックスが編集可能な場合、ポップアップを閉じずにコンボボックスにフォーカスを戻して文字を入力します。</li>
              <li>それ以外の場合、入力された文字で始まる名前を持つ次の提案値にフォーカスを移動します。</li>
            </ul>
          </li>
        </ul>
        <div class="note">
          <h4>注記</h4>
          <ol>
            <li>
              DOMフォーカスはコンボボックスに維持され、支援技術のフォーカスは、<a href="../../practices/keyboard-interface/keyboard-interface-practice.html#kbd_focus_activedescendant"> 複合要素での aria-activedescendant を使用したフォーカスの管理</a>で説明されているように、<code>aria-activedescendant</code> を使用してツリー内で移動されます。
            </li>
            <li>ツリーでは、コンボボックスの値に対して一度に一つの提案値のみを選択できます。</li>
            <li>
              ツリーポップアップでは、一部又は全ての親ノードは選択可能な値ではない場合があります。それらは、提案値のカテゴリラベルとして機能する場合があります。
              フォーカスが選択可能な値ではないノードに移動した場合、以下のいずれかになります:
              <ul>
                <li>以前に選択されたノードがある場合、そのノードはフォーカスが選択可能なノードに移動するまで選択されたままになります。</li>
                <li>選択された値はありません。</li>
                <li>いずれの場合も、フォーカスは選択と視覚的に区別されるため、利用者は値が選択されているかどうかを簡単に確認できます。</li>
              </ul>
            </li>
            <li>
              ツリー内のノードが水平方向に配置されている場合(<a href="#aria-orientation" class="property-reference">aria-orientation</a> が <code>horizontal</code> に設定されている):
              <ol>
                <li><kbd>下矢印</kbd>は上記で説明されている<kbd>右矢印</kbd>として機能し、その逆も同様です。</li>
                <li><kbd>上矢印</kbd>は上記で説明されている<kbd>左矢印</kbd>として機能し、その逆も同様です。</li>
              </ol>
            </li>
          </ol>
        </div>
        <h3>ダイアログポップアップのキーボード操作</h3>
        <p>ダイアログポップアップにフォーカスがある場合:</p>
        <ul>
          <li>
            ポップアップを閉じてフォーカスをコンボボックスに戻す方法は二つあります。
            <ol>
              <li>コンボボックスの値を指定するボタンを押すなど、ダイアログ内でアクションを実行します。</li>
              <li>
                ダイアログからキャンセルします。例えば、<kbd>Escape</kbd> を押すか、ダイアログのキャンセルボタンを押します。
                キャンセルすると、コンボボックスの値を変更せずにテキストボックスにフォーカスが戻る場合と、コンボボックスにフォーカスが戻ってコンボボックスがクリアされる場合があります。
              </li>
            </ol>
          </li>
          <li>ダイアログは、<a href="../dialog-modal/dialog-modal-pattern.html">モーダルダイアログパターン</a>で定義されているキーボード操作を実装します。</li>
        </ul>
        <div class="note">
          <h4>注記</h4>
          <p>他のコンボボックスポップアップとは異なり、ダイアログは <code>aria-activedescendant</code> をサポートしていないため、DOM フォーカスはコンボボックスからダイアログに移動します。</p>
        </div>
      </section>

      <section id="roles_states_properties">
        <h2>WAI-ARIA ロール、ステート、及びプロパティ</h2>
        <ul>
          <li>入力欄として機能し、コンボボックスの値を表示する要素は、ロール <a href="#combobox" class="role-reference">combobox</a> を持ちます。</li>
          <li>
            コンボボックス要素には、ポップアップとして機能する要素を参照する値に設定された <a href="#aria-controls" class="property-reference">aria-controls</a> があります。
            <code>aria-controls</code> は、ポップアップが表示されている場合にのみ設定する必要があることに注意してください。
            ただし、表示されていない要素を参照することも有効です。
          </li>
          <li>ポップアップは、ロール <a href="#listbox" class="role-reference">listbox</a>、<a href="#tree" class="role-reference">tree</a>、<a href="#grid" class="role-reference">grid</a>、又は <a href="#dialog" class="role-reference">dialog</a> を持つ要素です。</li>
          <li>
            ポップアップのロールが <code>listbox</code> 以外の場合、ロール <code>combobox</code> を持つ要素には、ポップアップの種類に対応する値に設定された <a href="#aria-haspopup" class="property-reference">aria-haspopup</a> があります。
            つまり、<code>aria-haspopup</code> は <code>grid</code>、<code>tree</code>、又は <code>dialog</code> に設定されます。
            ロール <code>combobox</code> を持つ要素には、<code>listbox</code> の暗黙の <code>aria-haspopup</code> の値を持つことに注意してください。
          </li>
          <li>
            コンボボックスポップアップが表示されていない場合、ロール <code>combobox</code> を持つ要素の <a href="#aria-expanded" class="state-reference">aria-expanded</a> は<code>false</code> に設定されます。
            ポップアップ要素が表示されている場合、<code>aria-expanded</code> は <code>true</code> に設定されます。
            ロール <code>combobox</code> を持つ要素には、<code>aria-expanded</code> のデフォルト値 <code>false</code> を持つことに注意してください。
          </li>
          <li>コンボボックスがフォーカスを受けると、DOM フォーカスはコンボボックス要素に置かれます。</li>
          <li>リストボックス、グリッド、又はツリーポップアップの子孫にフォーカスがある場合、DOM フォーカスはコンボボックスに残り、またコンボボックスは、ポップアップ内のフォーカスされた要素を参照する値に設定された <a href="#aria-activedescendant" class="property-reference">aria-activedescendant</a> を持ちます。</li>
          <li>リストボックス、グリッド、又はツリーポップアップを制御するコンボボックスでは、提案値が現在選択されている値として視覚的に示されている場合、その値を含む <code>option</code>、<code>gridcell</code>、<code>row</code>、又は <code>treeitem</code> の <a href="#aria-selected" class="state-reference">aria-selected</a> は <code>true</code> に設定されます。</li>
          <li>
            コンボボックスに表示可能なラベルがあり、コンボボックス要素が HTML の <code>label</code> 要素を使用してラベル付けできる HTML 要素 (例: <code>input</code> 要素) である場合、<code>label</code> 要素を使用してラベル付けされます。
            それ以外の場合、表示可能なラベルがある場合、コンボボックス要素は、ラベル付け要素を参照する値に設定された <a href="#aria-labelledby" class="property-reference">aria-labelledby</a> を持ちます。
            それ以外の場合、コンボボックス要素は、<a href="#aria-label" class="property-reference">aria-label</a> によって提供されるラベルを持ちます。
          </li>
          <li>
            コンボボックス要素は、オートコンプリート動作に対応する値に設定された <a href="#aria-autocomplete" class="property-reference">aria-autocomplete</a> を持ちます。
            <ul>
              <li><code>none</code>: ポップアップが表示されたとき、それに含まれる提案された値は、コンボボックスに入力された文字に関係なく同じです。</li>
              <li>
                <code>list</code>: ポップアップがトリガされたとき、提案された値が表示されます。
                コンボボックスが編集可能な場合、値はコンボボックスに入力された文字を補完又は論理的に対応します。
              </li>
              <li>
                <code>both</code>: ポップアップがトリガされたとき、コンボボックスに入力された文字を補完又は論理的に対応する提案された値が表示されます。
                更に、利用者が入力していない選択された提案の部分 (「補完文字列」と呼ばれる) は、コンボボックスの入力カーソルの後にインラインで表示されます。
                インライン補完文字列は視覚的に強調表示され、選択状態になります。
              </li>
            </ul>
          </li>
        </ul>
        <div class="note">
          <h3>注記</h3>
          <ol>
            <li>
              ARIA 1.0 では、コンボボックスは <a href="#aria-controls" class="property-reference">aria-controls</a> ではなく <a href="#aria-owns" class="property-reference">aria-owns</a> を使用してポップアップを参照していました。
              ユーザエージェントは、レガシーコンテンツとの下位互換性のために <a href="#aria-owns" class="property-reference">aria-owns</a> を持つコンボボックスをサポートする場合がありますが、<a href="#aria-controls" class="property-reference">aria-controls</a> を使用することを強くお勧めします。
            </li>
            <li>ポップアップに使用される以下のパターンに関するロール、ステート、及びプロパティのドキュメントを参照するときは、コンボボックスは単一選択ウィジェットであり、選択はポップアップ内のフォーカスに従うことに注意してください。</li>
            <li>
              ポップアップ要素のロール、ステート、及びプロパティは、それぞれのデザインパターンで定義されています。
              <ul>
                <li><a href="../listbox/listbox-pattern.html#roles_states_properties">リストボックスのロール、ステート、及びプロパティ</a></li>
                <li><a href="../grid/grid-pattern.html#roles_states_properties">グリッドのロール、ステート、及びプロパティ</a></li>
                <li><a href="../treeview/treeview-pattern.html#roles_states_properties">ツリーのロール、ステート、及びプロパティ</a></li>
                <li><a href="../dialog-modal/dialog-modal-pattern.html#roles_states_properties">ダイアログのロール、ステート、及びプロパティ</a></li>
              </ul>
            </li>
          </ol>
        </div>
      </section>
    </main>
  </body>
</html>
