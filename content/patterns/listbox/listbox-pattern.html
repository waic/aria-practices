<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>リストボックス パターン</title>

    <!-- Core JS and CSS shared by all patterns -->
    <link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2016/base.css">
    <link rel="stylesheet" href="../../shared/css/core.css">
    <script src="../../shared/js/highlight.pack.js"></script>
    <script src="../../shared/js/app.js"></script>
    <script src="../../shared/js/skipto.js"></script>
  </head>
  <body>
    <main>
      <h1>リストボックス パターン</h1>
      <!-- 翻訳元リビジョン: https://github.com/w3c/aria-practices/tree/7fb7c8e28b55a2804bda682c36945a1154d1096a -->

      <section id="about">
        <h2>このパターンについて</h2>
        <p>
          <a href="#listbox" class="role-reference">listbox</a> ウィジェットは、オプションのリストを表示し、利用者が1つ又は複数のオプションを選択できるようにします。
          単一のオプションのみを選択できるlistboxは、シングルセレクトlistboxと呼ばれ、複数のオプションを選択できるものはマルチセレクトlistboxと呼ばれます。
        </p>
        <p>
          スクリーンリーダーがlistboxを提示するとき、リスト内の各オプションの名前、ステート、及び位置をレンダリングすることができます。
          オプションの名前は、通常オプション要素のコンテンツからブラウザによって計算される文字列です。
          名前は平坦な文字列として、セマンティック情報を含んでいません。
          したがって、オプションにセマンティック要素、たとえば見出しが含まれている場合、スクリーンリーダーの利用者はそのセマンティクスにアクセスすることができません。
          加えて、listboxロールが支援技術に伝えるインタラクションモデルは、オプション内の要素との対話をサポートしていません。
          listboxウィジェットのこれらの特性のため、リンク、ボタン、又はチェックボックスなどの対話的な要素のリストを提示するアクセス可能な方法を提供しません。
          対話的な要素のリストを提示するには、<a href="../grid/grid-pattern.html">Grid パターン</a>を参照してください。
        </p>
        <p>
          非常に長いオプション名を避けることで、スクリーンリーダーの利用者の理解性及び知覚性が向上します。
          オプションの名前全体が、オプションが読み上げられるときに1つの発話ユニットとして話されます。
          1回のキー押下の結果として話される情報が多すぎると、理解するのが難しくなります。
          長い名前は、通常、利用者がオプション全体を再読する必要があるため、中断された発話の影響を増大させ、知覚を阻害します。
          また、利用者が話される内容を理解できない場合、listboxウィジェットの文脈で文字、単語、又はフレーズで名前を読むのは、多くのスクリーンリーダー利用者にとって難しい操作となることがあります。
        </p>
        <p>
          各オプション名が同じ単語又はフレーズで始まるオプションのセットも、キーボード及びスクリーンリーダーの利用者にとって使い勝手を大幅に低下させることができます。
          特定のオプションを見つけるためにリストをスクロールすることは、その単語又はフレーズが各オプションについてのユニークな部分を聞く前に繰り返されるので、スクリーンリーダーの利用者にとって非常に時間がかかるようになります。
          例えば、都市を選択するためのlistboxが、各都市名が国名で先行されるオプションを含む場合、多くの都市が各国でリストされている場合、スクリーンリーダーの利用者は各都市名を聞く前に国名を聞く必要があります。
          このようなシナリオでは、国と都市の2つのlistboxを持つ方が良いでしょう。
        </p>
      </section>

      <section id="examples">
        <h2>例</h2>
        <ul>
          <li><a href="examples/listbox-scrollable.html">スクロール可能な Listbox の例</a> : オプションを表示するためにスクロールするシングルセレクトlistbox、HTMLの <code>select</code> に <code>size</code> 属性が1より大きい場合と同様。</li>
          <li><a href="examples/listbox-rearrangeable.html">並べ替え可能なオプションを持つ例のListboxes</a> : オプションを追加、移動、及び削除できるツールバーを伴うシングルセレクト及びマルチセレクトlistboxesの例。</li>
          <li><a href="examples/listbox-grouped.html">グループ化されたオプションを持つ Listbox の例</a> : グループ化されたオプションを持つシングルセレクトlistbox、HTMLの <code>select</code> に <code>optgroup</code> 子供と同様。</li>
        </ul>
      </section>

      <section id="keyboard_interaction">
        <h2>キーボード操作</h2>
        <p>縦方向のリストボックスの場合：</p>
        <ul>
          <li>
            シングル選択リストボックスがフォーカスを受け取るとき：
            <ul>
              <li>
                リストボックスがフォーカスを受け取る前に選択されているオプションがない場合、最初のオプションにフォーカスが移動します。
                オプションで、最初の選択肢が自動的に選択される場合もあります。
              </li>
              <li>リストボックスがフォーカスを受け取る前に選択されているオプションがある場合、選択されているオプションにフォーカスが設定されます。</li>
            </ul>
          </li>
          <li>
            マルチ選択リストボックスがフォーカスを受け取るとき：
            <ul>
              <li>リストボックスがフォーカスを受け取る前に選択されているオプションがない場合、最初のオプションにフォーカスが設定され、選択状態は自動的に変更されません。</li>
              <li>リストボックスがフォーカスを受け取る前に一つまたはそれ以上のオプションが選択されている場合、リスト内で最初に選択されているオプションにフォーカスが設定されます。</li>
            </ul>
          </li>
          <li>
            <kbd>下矢印</kbd>：次のオプションにフォーカスを移動します。
            シングル選択リストボックスの場合、オプションで選択もフォーカスと共に移動することができます。
          </li>
          <li>
            <kbd>上矢印</kbd>：前のオプションにフォーカスを移動します。
            シングル選択リストボックスの場合、オプションで選択もフォーカスと共に移動することができます。
          </li>
          <li>
            <kbd>Home</kbd>（オプション）：最初のオプションにフォーカスを移動します。
            シングル選択リストボックスの場合、オプションで選択もフォーカスと共に移動することができます。
            5つ以上のオプションがあるリストでは、このキーをサポートすることが強く推奨されます。
          </li>
          <li>
            <kbd>End</kbd>（オプション）：最後のオプションにフォーカスを移動します。
            シングル選択リストボックスの場合、オプションで選択もフォーカスと共に移動することができます。
            5つ以上のオプションがあるリストでは、このキーをサポートすることが強く推奨されます。
          </li>
          <li>
            タイプアヘッドは、特に7つ以上のオプションがあるリストボックスで推奨されます：
            <ul>
              <li>文字を入力する：フォーカスは、入力された文字で始まる名前を持つ次の項目に移動します。</li>
              <li>短時間で複数の文字を入力する：フォーカスは、入力された文字列で始まる名前を持つ次の項目に移動します。</li>
            </ul>
          </li>
          <li>
            <strong>複数選択</strong>：著者は、複数の選択をサポートするための2つのインタラクションモデルのいずれかを実装することができます。一つはリストをナビゲートしながら修飾キー（<kbd>Shift</kbd> や <kbd>Control</kbd> など）を保持する必要がない推奨モデル、もう一つは選択状態を失うのを防ぐためにナビゲーション中に修飾キーを保持する必要がある代替モデルです。
            <ul>
              <li>
                推奨される選択モデル - 修飾キーを保持する必要はありません：
                <ul>
                  <li><kbd>Space</kbd>：フォーカスされているオプションの選択状態を変更します。</li>
                  <li><kbd>Shift + 下矢印</kbd>（オプション）：フォーカスを次のオプションに移動し、その選択状態を切り替えます。</li>
                  <li><kbd>Shift + 上矢印</kbd>（オプション）：フォーカスを前のオプションに移動し、その選択状態を切り替えます。</li>
                  <li><kbd>Shift + Space</kbd>（オプション）：最も最近選択されたアイテムからフォーカスされているアイテムまでの範囲内のすべてのアイテムの選択状態を切り替えます。</li>
                </ul>
              </li>
              <li>
                代替の選択モデル -- <kbd>Shift</kbd>または<kbd>Control</kbd>修飾キーを保持せずにフォーカスを移動すると、フォーカスが当たっているオプションを除くすべての選択されたオプションの選択が解除されます：
                <ul>
                  <li><kbd>Shift + 下矢印</kbd>: 次のオプションにフォーカスを移動し、その選択状態を切り替えます。</li>
                  <li><kbd>Shift + 上矢印</kbd>: 前のオプションにフォーカスを移動し、その選択状態を切り替えます。</li>
                  <li><kbd>Control + 下矢印</kbd>: その選択状態を変更せずに次のオプションにフォーカスを移動します。</li>
                  <li><kbd>Control + 上矢印</kbd>: その選択状態を変更せずに前のオプションにフォーカスを移動します。</li>
                  <li><kbd>Control + Space</kbd> フォーカスされているオプションの選択状態を変更します。</li>
                  <li><kbd>Shift + Space</kbd> (オプション): 最も最近選択されたアイテムからフォーカスされているアイテムまでの範囲内のすべてのアイテムを選択します。</li>
                  <li>
                    <kbd>Control + Shift + Home</kbd> (オプション): フォーカスされているオプションおよび最初のオプションまでのすべてのオプションを選択します。
                    オプションで、最初のオプションにフォーカスを移動することもできます。
                  </li>
                  <li>
                    <kbd>Control + Shift + End</kbd> (オプション): フォーカスされているオプションおよび最後のオプションまでのすべてのオプションを選択します。
                    オプションで、最後のオプションにフォーカスを移動することもできます。
                  </li>
                  <li>
                    <kbd>Control + A</kbd> (オプション): リスト内のすべてのオプションを選択します。
                    オプションで、すべてのオプションが選択されている場合、すべてのオプションの選択を解除することもできます。
                  </li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
        <div class="note">
          <h3>注記</h3>
          <ol>
            <li>
              DOM フォーカス（アクティブな要素）は、選択されたステートとは機能的に異なります。
              詳細は、<a href="../../practices/keyboard-interface/keyboard-interface-practice.html#kbd_focus_vs_selection">フォーカス 及び 選択の違いに関するこの説明</a>を参照してください。
            </li>
            <li>
              <code>listbox</code> ロールは、<a class="property-reference" href="#aria-activedescendant">aria-activedescendant</a> プロパティをサポートしており、キーボードナビゲーションを実装する際に、<code>option</code> 要素の間で DOM フォーカスを移動する代替手段を提供します。
              詳細については、<a href="../../practices/keyboard-interface/keyboard-interface-practice.html#kbd_focus_activedescendant">aria-activedescendant を使用したコンポジット内のフォーカスの管理</a>を参照してください。
            </li>
            <li>
              単一選択の listbox では、フォーカスを移動することで、以前に選択されたオプションの選択を解除し、新しくフォーカスされたオプションを選択することができます。
              この選択モデルは、&quot;選択がフォーカスに従う&quot;として知られています。
              選択がフォーカスに従うことは、ある状況では非常に役立ちますが、他の状況ではアクセシビリティを大幅に低下させる可能性があります。
              追加のガイダンスについては、<a href="../../practices/keyboard-interface/keyboard-interface-practice.html#kbd_selection_follows_focus">選択を自動的にフォーカスに従わせるかどうかを決定する</a>を参照してください。
            </li>
            <li>すべてのオプションを選択 又は 選択解除することが重要な機能である場合、これらのアクションのための別のコントロールを実装すること、例えば &quot;すべて選択&quot; 及び &quot;すべて選択解除&quot; のボタン、はアクセシビリティを大幅に向上させます。</li>
            <li>
              listbox のオプションが水平に配置されている場合:
              <ol>
                <li><kbd>下矢印</kbd> は、上記で説明されている <kbd>右矢印</kbd> として動作し、その逆も同様です。</li>
                <li><kbd>上矢印</kbd> は、上記で説明されている <kbd>左矢印</kbd> として動作し、その逆も同様です。</li>
              </ol>
            </li>
          </ol>
        </div>
      </section>

      <section id="roles_states_properties">
        <h2>WAI-ARIA ロール、ステート、及びプロパティ</h2>
        <ul>
          <li>すべての listbox オプションを含む又は所有する要素はロール<a href="#listbox" class="role-reference">listbox</a>を持っています。</li>
          <li>
            listbox 内の各オプションはロール<a href="#option" class="role-reference">option</a>を持ち、以下のいずれかに含まれる又は所有されます:
            <ul>
              <li>ロール<code>listbox</code>を持つ要素。</li>
              <li>ロール<a href="#group" class="role-reference">group</a>を持ち、ロール<code>listbox</code>を持つ要素に含まれる又はその要素によって所有される要素。</li>
            </ul>
          </li>
          <li>
            <code>group</code>内に含まれるオプションは<q>グループ化されたオプション</q>と呼ばれ、<q>オプショングループ</q>というものを形成します。
            listbox がグループ化されたオプションを含む場合、以下が適用されます:
            <ul>
              <li>すべてのオプショングループは少なくとも1つのオプションを含んでいます。</li>
              <li>各オプショングループは<a href="#aria-label" class="property-reference">aria-label</a>又は<a href="#aria-labelledby" class="property-reference">aria-labelledby</a>を通じてアクセス可能な名前を持っています。</li>
            </ul>
          </li>
          <li>ロール<code>listbox</code>を持つ要素が、例えば combobox のような他のウィジェットの一部でない場合、<a href="#aria-labelledby" class="property-reference">aria-labelledby</a>によって参照される表示ラベルを持つか、<a href="#aria-label" class="property-reference">aria-label</a>の値が指定されています。</li>
          <li>
            listbox が複数のオプションの選択をサポートする場合、ロール<code>listbox</code>を持つ要素は<a class="property-reference" href="#aria-multiselectable">aria-multiselectable</a>を<code>true</code>に設定します。
            それ以外の場合、<code>aria-multiselectable</code>は<code>false</code>に設定されるか、<code>false</code>のデフォルト値が暗黙的に設定されます。
          </li>
          <li>
            選択可能な各オプションの選択ステートは、<a href="#aria-selected" class="state-reference">aria-selected</a>又は<a href="#aria-checked" class="state-reference">aria-checked</a>のいずれかで示されます:
            <ul>
              <li>
                選択ステートが<code>aria-selected</code>で示される場合、<code>aria-checked</code>はどのオプションにも指定されません。
                逆に、選択ステートが<code>aria-checked</code>で示される場合、<code>aria-selected</code>はどのオプションにも指定されません。
                どちらのプロパティを使用するかの考慮事項や、同じ listbox で両方のプロパティが許可される可能性のある珍しい条件の詳細については、以下の注記を参照してください。
              </li>
              <li>
                オプションが選択されている場合、各選択されたオプションは、<a href="#aria-selected" class="state-reference">aria-selected</a>又は<a href="#aria-checked" class="state-reference">aria-checked</a>が<code>true</code>に設定されています。
                ロール<code>listbox</code>が<code>true</code>に設定されていない<a class="property-reference" href="#aria-multiselectable">aria-multiselectable</a>を持つ場合、一度に選択されるオプションは1つだけです。
              </li>
              <li>選択可能でありながら選択されていないすべてのオプションは、<a href="#aria-selected" class="state-reference">aria-selected</a>又は<a href="#aria-checked" class="state-reference">aria-checked</a>が<code>false</code>に設定されています。</li>
              <li>
                選択がフォーカスに従う listbox を除いて、選択ステートはフォーカスとは異なります。
                詳細については、<a href="../../practices/keyboard-interface/keyboard-interface-practice.html#kbd_focus_vs_selection">フォーカスと選択の違いの説明</a>及び<a href="../../practices/keyboard-interface/keyboard-interface-practice.html#kbd_selection_follows_focus">選択が自動的にフォーカスに従うタイミングの決定</a>を参照してください。
              </li>
            </ul>
          </li>
          <li>利用可能なオプションの完全なセットがDOMに存在しない場合、ユーザーがスクロールすることで動的に読み込まれるため、<a href="#aria-setsize" class="property-reference">aria-setsize</a>及び<a href="#aria-posinset" class="property-reference">aria-posinset</a>属性が適切に設定されています。</li>
          <li>
            オプションが水平に配置されている場合、ロール<code>listbox</code>を持つ要素は<a href="#aria-orientation" class="property-reference">aria-orientation</a>を<code>horizontal</code>に設定しています。
            <code>listbox</code>の<code>aria-orientation</code>のデフォルト値は<code>vertical</code>です。
          </li>
        </ul>
        <div class="note">
          <h3>注記</h3>
          <ol>
            <li>
              <code>aria-selected</code> と <code>aria-checked</code> のどちらを使用して選択を示すかを選ぶ際の考慮事項は以下の通りです:
              <ul>
                <li>
                  一部のデザインシステムは、シングルセレクトウィジェットに<code>aria-selected</code>を、マルチセレクトウィジェットに<code>aria-checked</code>を使用しています。
                  他の慣習がより適切であるとする要因がない場合、これは推奨される慣習です。
                </li>
                <li>
                  指示の言葉やインターフェースの外観が、一方の属性が他方よりも適切であることを示唆するかもしれません。
                  例えば、指示はアイテムを<q>選択</q>するようにと言っていますか？
                  また、選択の視覚的な指標はチェックマークですか？
                </li>
                <li>サイトやアプリ全体での選択モデルに一貫した慣習を採用することが重要です。</li>
              </ul>
            </li>
            <li>
              listboxが<code>aria-selected</code>と<code>aria-checked</code>の両方を含む条件は非常にまれです。
              一つの状態よりも多いニーズがあるlistboxウィジェットの設計を避けることを強く推奨します。
              listbox内で両方の状態を使用する場合、以下の条件すべてが満たされる必要があります:
              <ul>
                <li>ユーザーインターフェースにおける<code>aria-selected</code>の意味と目的は、<code>aria-checked</code>の意味と目的とは異なります。</li>
                <li>ユーザーインターフェースは、各状態の意味と目的を明確にします。</li>
                <li>ユーザーインターフェースは、各状態を制御するための別々の方法を提供します。</li>
              </ul>
            </li>
            <li>
              listbox要素に<a href="#aria-owns" class="property-reference">aria-owns</a>が設定され、コンテナのDOM子要素でない要素を含む場合、それらの要素は参照された順序で読み取り順序に表示され、DOM子要素であるアイテムの後に表示されます。
              フォーカスを管理するスクリプトは、視覚的なフォーカスの順序がこの支援技術の読み取り順序と一致するように確認する必要があります。
            </li>
          </ol>
        </div>
      </section>
    </main>
  </body>
</html>
