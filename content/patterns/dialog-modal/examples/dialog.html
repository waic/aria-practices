<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>モーダルダイアログの例</title>

    <!-- Core JS and CSS shared by all examples -->
    <link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2016/base.css">
    <link rel="stylesheet" href="../../../shared/css/core.css">
    <script src="../../../shared/js/examples.js"></script>
    <script src="../../../shared/js/highlight.pack.js"></script>
    <script src="../../../shared/js/app.js"></script>
    <script data-skipto="colorTheme:aria; displayOption:popup; containerElement:div" src="../../../shared/js/skipto.js"></script>

    <!-- JS and CSS for this example -->
    <link href="css/dialog.css" rel="stylesheet">
    <script src="../../../shared/js/utils.js"></script>
    <script src="js/dialog.js"></script>
  </head>
  <body>
    <nav aria-label="Related Links" class="feedback">
      <ul>
        <li><a href="https://github.com/w3c/aria-practices/projects/6">Related Issues</a></li>
        <li><a href="../dialog-modal-pattern.html">Design Pattern</a></li>
      </ul>
    </nav>
    <main>
      <h1>モーダルダイアログの例</h1>
      <!-- 翻訳元リビジョン: https://github.com/w3c/aria-practices/tree/39fb654e5146151ee70675af6ae755a72d8f7ff4 -->

      <section>
        <h2>この例について</h2>
        <img alt="" class="example-page-example-icon" src="../../../images/pattern-dialog-modal.svg">
        <p>
          以下は、<a href="../dialog-modal-pattern.html">ダイアログ (モーダル) パターン</a>の実装例です。
          下記の「配送先住所を追加」ボタンを押すと、モーダルダイアログが開き、その中に他のダイアログを開くボタンが 2 つ含まれています。
          アクセシビリティ機能のセクションでは、各ダイアログにおける初期フォーカス位置と <code>aria-describedby</code> の使用に関する理由を説明しています。
        </p>
        <p>類似の例には以下があります。</p>
        <ul>
          <li><a href="../../alertdialog/examples/alertdialog.html">アラートダイアログ例</a>：確認プロンプトを示すアラートダイアログの例です。</li>
          <li><a href="datepicker-dialog.html">日付選択ダイアログ例</a>：日付を選択するためのカレンダーグリッドを含むダイアログを示します。</li>
        </ul>
      </section>

      <section>
        <div class="example-header">
          <h2 id="ex_label">例</h2>
        </div>
        <div role="separator" id="ex_start_sep" aria-labelledby="ex_start_sep ex_label" aria-label="Start of"></div>
        <div id="ex1">
          <button type="button" onclick="openDialog('dialog1', this)">配送先住所を追加</button>
          <div id="dialog_layer" class="dialogs">
            <div role="dialog" id="dialog1" aria-labelledby="dialog1_label" aria-modal="true" class="hidden">
              <h2 id="dialog1_label" class="dialog_label">配送先住所を追加</h2>
              <div class="dialog_form">
                <div class="dialog_form_item">
                  <label>
                    <span class="label_text">郵便番号：</span>
                    <input type="text" class="zip_input">
                  </label>
                </div>
                <div class="dialog_form_item">
                  <label>
                    <span class="label_text">都道府県：</span>
                    <input type="text" class="state_input">
                  </label>
                </div>
                <div class="dialog_form_item">
                  <label>
                    <span class="label_text">市区町村：</span>
                    <input type="text" class="city_input">
                  </label>
                </div>
                <div class="dialog_form_item">
                  <label>
                    <span class="label_text">住所：</span>
                    <input type="text" class="wide_input">
                  </label>
                </div>
            
                <div class="dialog_form_item">
                  <label for="special_instructions">
                    <span class="label_text">備考：</span>
                  </label>
                  <input id="special_instructions" type="text" aria-describedby="special_instructions_desc" class="wide_input">
                  <div class="label_info" id="special_instructions_desc">例えば、オートロックの暗証番号や配達員があなたを見つけるためのその他の情報</div>
                </div>
              </div>
              <div class="dialog_form_actions">
                <button type="button" onclick="openDialog('dialog2', this, 'dialog2_para1')">住所を検証</button>
                <button type="button" onclick="replaceDialog('dialog3', undefined, 'dialog3_close_btn')">追加</button>
                <button type="button" onclick="closeDialog(this)">キャンセル</button>
              </div>
            </div>            

            <!--  Second modal to open on top of the first modal  -->
            <div id="dialog2" role="dialog" aria-labelledby="dialog2_label" aria-describedby="dialog2_desc" aria-modal="true" class="hidden">
              <h2 id="dialog2_label" class="dialog_label">検証結果</h2>
              <div id="dialog2_desc" class="dialog_desc">
                <p tabindex="-1" id="dialog2_para1">
                  これは単なるデモです。
                  実際のアプリケーションであれば、入力されたアドレスが有効かどうかを示すメッセージが提供されます。
                </p>
                <p>
                  デモのために、このダイアログには多くのテキストがあります。
                  これは、以下のシナリオを示しています：
                </p>
                <ul>
                  <li>最初のインタラクティブ要素であるヘルプリンクは、ダイアログの一番下にあります。</li>
                  <li>ダイアログが開いたときに最初のインタラクティブ要素にフォーカスが置かれると、検証メッセージが表示されない可能性があります。</li>
                  <li>検証メッセージが表示され、フォーカスがヘルプリンクにある場合、フォーカスが表示されない可能性があります。</li>
                  <li>
                    ダイアログが開くとき、以下の両方が重要です：
                    <ul>
                      <li>テキストの開始部分が見えるようにする必要があります。そうすれば、利用者は読み始めるためにスクロールを戻す必要はありません。</li>
                      <li>キーボードフォーカスは常に表示されるようにする必要があります。</li>
                    </ul>
                  </li>
                </ul>
                <p>この問題を解決するにはいくつかの方法があります：</p>
                <ul>
                  <li>ダイアログの上部にインタラクティブ要素 (ボタンやリンクなど) を配置します。</li>
                  <li>静的な要素をフォーカス可能にします (例：ダイアログタイトルや最初のテキストブロック)。</li>
                </ul>
                <p> dialog ロールを持つ要素をフォーカス可能に<em>してはいけません</em>！</p>
                <ul>
                  <li>フォーカス可能な要素が大きいほど、特に視野の狭い利用者にとって、フォーカスの位置を視覚的に特定するのが難しくなります。</li>
                  <li>ダイアログには視覚的な境界線があるため、ダイアログ全体にフォーカスがあるときにフォーカスの明確な視覚的インジケーターを作成することは余り現実的ではありません。</li>
                  <li>
                    スクリーンリーダーは、フォーカス可能な要素のラベルとコンテンツを読み上げます。
                    ダイアログにはラベルと多くのコンテンツが含まれています！このようなダイアログにフォーカスがある場合、実際のフォーカスを理解することは困難です。
                  </li>
                </ul>
                <p>
                  このダイアログでは、最初の段落に <code>tabindex=<q>-1</q></code> があります。
                  最初の段落は、ダイアログの説明を提供する要素 (つまり、<code>aria-describedby</code> で参照される要素) 内にも含まれています。
                  一部のスクリーンリーダーでは、これにより、ダイアログが開いたときに、1 つのネガティブであるものの比較的取るに足らない副作用が発生する可能性――最初の段落が 2 回アナウンスされる可能性があります。
                  それにもかかわらず、最初の段落をフォーカス可能にして、そこに初期フォーカスを設定することが、最も広くアクセシブルなオプションです。
                </p>
              </div>
              <div class="dialog_form_actions">
                <a href="#" onclick="openDialog('dialog4', this)">ヘルプへのリンク</a>
                <button type="button" onclick="openDialog('dialog4', this)">代替フォームを受け入れる</button>
                <button type="button" onclick="closeDialog(this)">閉じる</button>
              </div>
            </div>

            <!--  Dialog that replaces dialog 1.  -->
            <div id="dialog3" role="dialog" aria-labelledby="dialog3_label" aria-describedby="dialog3_desc" aria-modal="true" class="hidden">
              <h2 id="dialog3_label" class="dialog_label">住所が追加されました</h2>
              <p id="dialog3_desc" class="dialog_desc">
                ご指定の住所が配送先住所リストに追加されました。
                すぐにご利用いただけます。
                削除したい場合は、<a href="#" onclick="openDialog('dialog4', this)">プロフィール</a>から行えます。
              </p>
              <div class="dialog_form_actions">
                <button type="button" id="dialog3_close_btn" onclick="closeDialog(this)">OK</button>
              </div>
            </div>

            <div id="dialog4" role="dialog" aria-labelledby="dialog4_label" aria-describedby="dialog4_desc" class="hidden" aria-modal="true">
              <h2 id="dialog4_label" class="dialog_label">一巻の終わり！</h2>
              <p id="dialog4_desc" class="dialog_desc">偽のリンク又はボタンがアクティブ化されました！このリンク又はボタンはデモ目的でのみ表示されています。</p>
              <div class="dialog_form_actions">
                <button type="button" id="dialog4_close_btn" onclick="closeDialog(this)">閉じる</button>
              </div>
            </div>
          </div>
        </div>
        <div role="separator" id="ex_end_sep" aria-labelledby="ex_end_sep ex_label" aria-label="End of"></div>
      </section>

      <section>
        <h2>アクセシビリティ機能</h2>
        <ol>
          <li>
            小さな画面で表示する場合の読みやすさを向上させるため、ダイアログは画面の100%を満たします。
            背景ウィンドウを完全に覆うことで、一部のモバイルデバイスでダイアログ内のコンテンツをスクロールしたときに発生する背景の動きも隠されます。
          </li>
          <li>
            フォーカスとアクセシブルな説明は、各ダイアログのコンテンツに基づいて設定されます。
            <ol>
              <li>
                「配送先住所を追加」ダイアログ (id=dialog1):
                <ul>
                  <li>最初のフォーカス可能な要素である最初の入力欄に初期フォーカスが設定されます。</li>
                  <li>ダイアログを説明する静的なテキストがないため、<code>aria-describedby</code> は必要ありません。</li>
                  <li>「キャンセル」アクションの結果としてダイアログが閉じられたとき、「配送先住所を追加」ボタンにフォーカスを戻すことで利用者の視点が維持されます。</li>
                  <li>「追加」アクションの結果としてダイアログが閉じ、「配送先住所を追加」ダイアログが「住所が追加されました」ダイアログに置き換わったとき、「配送先住所を追加」ダイアログは「住所が追加されました」ダイアログに「配送先住所を追加」ボタンへの参照を渡すため、閉じるときに利用者の視点を維持できます。</li>
                </ul>
              </li>
              <li>
                「検証結果」ダイアログ (id=dialog2):
                <ul>
                  <li>最初のインタラクティブ要素が最下部にあり、それがテキストの長さによりビューの外にあるため、最初の段落に初期フォーカスが設定されます。</li>
                  <li>スクリーンリーダー利用者がダイアログテキストを認識できるように、ダイアログテキストは <code>aria-describedby</code> によって参照される <code>div</code> でラップされます。</li>
                  <li>ダイアログが閉じたとき、フォーカスを「住所を検証」ボタンに戻すことで利用者の視点が維持されます。</li>
                  <li>このダイアログのテキストは、大量のテキストを含むダイアログでの初期フォーカスとアクセシブルな説明の設計上の考慮事項について説明しています。</li>
                </ul>
              </li>
              <li>
                「住所が追加されました」ダイアログ (id=dialog3):
                <ul>
                  <li>
                    最後のフォーカス可能な要素である「OK」ボタンに初期フォーカスが設定されます。
                    これは、ほとんどの利用者がメッセージを読んだらすぐにダイアログを閉じるため、効率的です。
                    利用者は<kbd>Tab</kbd>キーを押すことで「マイプロフィール」リンクにフォーカスできます。
                  </li>
                  <li>ダイアログメッセージを含む要素は、<code>aria-describedby</code> によって参照され、ダイアログが開いたときにアナウンスされるべきであることをスクリーンリーダーに示唆します。</li>
                  <li>ダイアログが閉じたとき、「配送先住所を追加」ボタンにフォーカスを設定することで利用者の視点が維持されます。</li>
                </ul>
              </li>
              <li>
                「一巻の終わり！」ダイアログ (id=dialog4):
                <ul>
                  <li>このダイアログはフォーカス可能な要素を1つだけ持っていて、ダイアログが開いたときにフォーカスを受け取ります。</li>
                  <li>ダイアログ3と同様に、<code>aria-describedby</code> を使用して、スクリーンリーダー利用者のためのメッセージのアナウンスを容易にします。</li>
                  <li>この例の「住所が追加されました」確認ダイアログを除く他のすべてのダイアログと同様に、閉じたときは、ダイアログの表示をトリガした要素にフォーカスを戻すことで利用者の視点が維持されます。</li>
                </ul>
              </li>
            </ol>
          </li>
        </ol>
      </section>

      <section>
        <h2 id="kbd_label">キーボードのサポート</h2>
        <table aria-labelledby="kbd_label" class="def">
          <thead>
            <tr>
              <th>キー</th>
              <th>機能</th>
            </tr>
          </thead>
          <tbody>
            <tr data-test-id="key-tab">
              <th><kbd>Tab</kbd></th>
              <td>
                <ul>
                  <li>ダイアログ内の次のフォーカス可能な要素にフォーカスを移動します。</li>
                  <li>ダイアログ内の最後のフォーカス可能な要素にフォーカスがある場合、ダイアログ内の最初のフォーカス可能な要素にフォーカスを移動します。</li>
                </ul>
              </td>
            </tr>
            <tr data-test-id="key-shift-tab">
              <th><kbd>Shift + Tab</kbd></th>
              <td>
                <ul>
                  <li>ダイアログ内の前のフォーカス可能な要素にフォーカスを移動します。</li>
                  <li>ダイアログ内の最初のフォーカス可能な要素にフォーカスがある場合、ダイアログ内の最後のフォーカス可能な要素にフォーカスを移動します。</li>
                </ul>
              </td>
            </tr>
            <tr data-test-id="key-escape">
              <th><kbd>Escape</kbd></th>
              <td>ダイアログを閉じます。</td>
            </tr>
          </tbody>
        </table>
      </section>

      <section>
        <h2 id="rps_label">ロール、プロパティ、ステート、及び tabindex 属性</h2>
        <table aria-labelledby="rps_label" class="data attributes">
          <thead>
            <tr>
              <th scope="col">ロール</th>
              <th scope="col">属性</th>
              <th scope="col">要素</th>
              <th scope="col">使用法</th>
            </tr>
          </thead>
          <tbody>
            <tr data-test-id="dialog-role">
              <th scope="row"><code>dialog</code></th>
              <td></td>
              <td><code>div</code></td>
              <td>ダイアログコンテナとして機能する要素を識別します。</td>
            </tr>
            <tr data-test-id="aria-labelledby">
              <td></td>
              <th scope="row">
                <code>aria-labelledby=<q>IDREF</q></code>
              </th>
              <td><code>div</code></td>
              <td>ダイアログタイトルを提供する要素を参照することで、ダイアログにアクセシブルな名前を与えます。</td>
            </tr>
            <tr data-test-id="aria-describedby">
              <td></td>
              <th scope="row">
                <code>aria-describedby=<q>IDREF</q></code>
              </th>
              <td><code>div</code></td>
              <td>
                <ul>
                  <li>ダイアログの主要なメッセージ又は目的を説明するダイアログコンテンツを参照することで、ダイアログにアクセシブルな説明を与えます。</li>
                  <li>
                    例に含まれる4つのダイアログのうち3つで使用されています。
                    アクセシビリティ機能のセクションを参照してください。
                  </li>
                </ul>
              </td>
            </tr>
            <tr data-test-id="aria-modal">
              <td></td>
              <th scope="row">
                <code>aria-modal=<q>true</q></code>
              </th>
              <td><code>div</code></td>
              <td>現在のダイアログの背面のウィンドウはインタラクションに使用できない (不活性) ことを支援技術に伝えます。</td>
            </tr>
          </tbody>
        </table>
        <h3><code>aria-modal</code> 及び <code>aria-hidden</code> に関する注記</h3>
        <ol>
          <li>
            <code>aria-modal</code> プロパティはARIA 1.1で導入されました。
            新しいプロパティであるため、スクリーンリーダー利用者はさまざまな程度のサポートを経験するかもしれません。
          </li>
          <li><code>aria-modal</code> プロパティを <code>dialog</code> 要素に適用することは、支援技術にダイアログ外のコンテンツが不活性であることを通知する目的で背景に <code>aria-hidden</code> を使用するテクニックを置き換えます。</li>
          <li>
            レガシーなダイアログ実装で <code>aria-hidden</code> を使用してダイアログ外のコンテンツを支援技術利用者にとって不活性にする場合、以下が重要です。
            <ol>
              <li>不活性レイヤーの一部を含む各要素に対して <code>aria-hidden</code> を <code>true</code> に設定します。</li>
              <li>ダイアログ要素は、<code>aria-hidden</code> が <code>true</code> に設定されている要素の子孫ではありません。</li>
            </ol>
          </li>
        </ol>
      </section>

      <section id="at-support">
        <h2>支援技術のサポート</h2>
        <p><a href="../../../about/at-support-tables/at-support-tables.html">支援技術サポートデータの解釈と使用方法について学ぶ</a></p>
        <iframe
          class="support-levels-modal-dialog"
          src="https://aria-at.w3.org/embed/reports/modal-dialog"
          height="100"
          allow="clipboard-write"
          style="border-style: none; width: 100%;">
        </iframe>
      </section>

      <section>
        <h2>JavaScript と CSS のソースコード</h2>
        <ul id="css_js_files">
          <li>
            CSS:
            <a href="css/dialog.css" type="text/css">dialog.css</a>
          </li>
          <li>
            Javascript:
            <a href="js/dialog.js" type="text/javascript">dialog.js</a>,
            <a href="../../../shared/js/utils.js">utils.js</a>
          </li>
        </ul>
      </section>

      <section>
        <h2 id="sc1_label">HTML のソースコード</h2>
        <div role="separator" id="sc1_start_sep" aria-labelledby="sc1_start_sep sc1_label" aria-label="Start of"></div>
        <pre><code id="sc1"></code></pre>
        <div role="separator" id="sc1_end_sep" aria-labelledby="sc1_end_sep sc1_label" aria-label="End of"></div>
        <script>
          sourceCode.add('sc1', 'ex1', 'ex_label', 'css_js_files');
          sourceCode.make();
        </script>
      </section>
    </main>
  </body>
</html>
